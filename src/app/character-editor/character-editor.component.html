<datalist id="faction-list">
  @for (faction of tup.factions; track faction;) {
    <option [attr.value]="faction"></option>
  }
</datalist>
<datalist id="sphere-list">
  @for (sphere of tup.spheres; track sphere;) {
    <option [attr.value]="sphere[0]"></option>
  }
</datalist>
<datalist id="health-sphere-list">
  @for (sphere of tup.spheres; track sphere;) {
    @if (sphere[1]) {
      <option [attr.value]="sphere[0]"></option>
    }
  }
</datalist>
<datalist id="morale-sphere-list">
  @for (sphere of tup.spheres; track sphere;) {
    @if (sphere[2]) {
      <option [attr.value]="sphere[0]"></option>
    }
  }
</datalist>
<div class="character-edit" [formGroup]="formGroup">
<section class="config">
  <h1 class="head">Edit Character</h1>
  <div>
    <div><label><input type="checkbox" formControlName="configS2S"> Session 2 started</label></div>
    <div><label><input type="number" formControlName="configCharacterCount"> Number of Heroes</label></div>
    <div class="flex">
      <div>
        <div><label><input type="radio" formControlName="configAutoInvB" value="on"> <span class="invb-from-char-count">11</span></label></div>
        <div><input type="radio" formControlName="configAutoInvB" value=""> <input type="number" formControlName="configInvestigativeBuild" id="edit-char-config-invb"></div>
      </div>
      <div>
        <label>&nbsp;Investigative Points</label>
      </div>
    </div>
    <div><label><input type="number" formControlName="configGeneralBuild"> General Points</label></div>
    <div><label><input type="number" formControlName="configStaminaBuild"> Stamina Points</label></div>
    <div><label><input type="number" formControlName="configMinStamina"> Minimum Stamina</label></div>
    <div><label><input type="number" formControlName="configFreeAllies"> Free Allies</label></div>
    <div><label><input type="number" formControlName="configFreeEnemies"> Free Enemies</label></div>
    <div><label><input type="number" formControlName="advancement"> Advancement Points</label></div>
  </div>
</section>
<div class="character-edit-grid character-sheet">
  <div class="panel name-panel">
    <div class="name-field">
      <label>
        <div class="label">Name</div>
        <div class="input"><input type="text" formControlName="name" class="large"></div>
      </label>
    </div>
    <div class="true-name-known-field">
      <label>
        <div class="label">True Name? <input type="checkbox" formControlName="tnk"></div>
        <div class="note">Check if True Name is known</div>
      </label>
    </div>
    <div class="profession-field">
      <label>
        <div class="label">Profession</div>
        <div class="input"><input type="text" formControlName="profession" class="large"></div>
      </label>
    </div>
    <div class="adjectives-field">
      <div class="label">Adjectives</div>
      @for (adj of adjectives; track adj; let i = $index) {
        <div class="input">
          <input type="text" id="adj{{i}}" [(ngModel)]="adj.value" [ngModelOptions]="{standalone: true}">
          <button class="del" (click)="delAdjective(i)">−</button>
        </div>
      }
      <div [ngClass]="'add' + ((adjectives.length >= 5) ? ' add-full' : '')"><button (click)="addAdjective()">+</button></div>
    </div>
  </div>
  <div class="logo"><img src="assets/logo.png" alt="Swords of the Serpentine"></div>
  <div class="panel portrait-panel">
    <div>
      <div class="head label">Character Portrait</div>
    </div>
  </div>
  <div class="panel drives-panel">
    <div>
      <div class="head label">What is Best in Life?</div>
      <div class="input"><input type="text" formControlName="drive1"></div>
      <div class="input"><input type="text" formControlName="drive2"></div>
      <div class="input"><input type="text" formControlName="drive3"></div>
    </div>
  </div>
  <section class="investigative-abilities subgrid">
    <h4 class="title1"><span>Investigative Abilities</span></h4>
    @for (category of invCatNames; track category) {
      <div [ngClass]="'panel ' + category + '-panel'">
        <div>
          <h5 class="head">{{ category.charAt(0).toUpperCase() + category.slice(1) }}</h5>
          @for (ability of invCats[category]; track ability;) {
            <div class="ability">
              <div class="ability-name">{{ ability.name }}</div>
              <div *ngIf="ability.healthMorale">
                <div class="label-tiny" *ngIf="invAbilities[category][ability.name] >= 1">
                  <div><label><input type="radio" formControlName="spotFrailty" value="health"> Health</label></div>
                  <div><label><input type="radio" formControlName="spotFrailty" value="morale"> Morale</label></div>
                </div>
              </div>
              <div class="ability-value">
                <div *ngFor="let i of aiToFrom(5)">
                  <div
                    class="circle"
                    [ngClass]="'circle' + ((invAbilities[category][ability.name] >= i) ? ' filled' : '')"
                    (click)="setInvAbility(category, ability.name, i)"
                  ></div>
                </div>
              </div>
            </div>
          }
        </div>
      </div>
    }
  </section>
  <h4 class="title2"><span>General Abilities</span></h4>
  <h4 class="title3"><span>Allegiances</span></h4>
  <div class="panel general-panel">
    <div>
      @for (ability of genAbilityDefs; track ability;) {
        <div [ngClass]="'ability' + (ability.combat ? ' combat' : '')">
          <div class="ability-name">{{ ability.name }}</div>
          <div class="general-ability">
            <div class="ability-value">
              <div *ngFor="let i of aiToFrom(15)">
                <div
                  class="circle"
                  [ngClass]="'circle' + ((genAbilities[ability.name] >= i) ? ' filled' : '') + (i == 8 ? ' talent' : '')"
                  (click)="setGenAbility(ability.name, i)"
                ></div>
              </div>
            </div>
            <div [ngClass]="'talent-name' + ((genAbilities[ability.name] < 8) ? ' locked' : '')">{{ ability.talent }}</div>
          </div>
        </div>
      }
    </div>
  </div>
  <div class="panel allegiances-panel">
    <div>
      @for (adj of allegiances; track adj; let i = $index) {
        <div class="input">
          <input type="text" class="allegiances" id="alleg{{i}}" [(ngModel)]="allegiances[i].name" [ngModelOptions]="{standalone: true}" list="faction-list" />
          <div>
            <div class="ability-value">
              <div *ngFor="let j of aiToFrom(5)">
                <div
                  class="circle"
                  [ngClass]="'circle' + ((allegiances[i].allyRanks >= j) ? ' filled' : '')"
                  (click)="allegiances[i].allyRanks = j"
                >A</div>
              </div>
            </div>
            <div class="ability-value">
              <div *ngFor="let j of aiToFrom(5)">
                <div
                  class="circle red"
                  [ngClass]="'circle' + ((allegiances[i].enemyRanks >= j) ? ' filled' : '')"
                  (click)="allegiances[i].enemyRanks = j"
                >E</div>
              </div>
            </div>
          </div>
          <button class="del" (click)="delAllegiance(i)">−</button>
        </div>
      }
      <div [ngClass]="'add' + ((allegiances.length >= 12) ? ' add-full' : '')"><button (click)="addAllegiance()">+</button></div>
    </div>
  </div>
  <div class="panel wealth-panel">
    <label class="flex">
      <div class="label">Wealth</div>
      <input type="number" formControlName="wealth">
    </label>
    <div class="lifestyle">
      <div class="label">Lifestyle</div>
      <div>{{ tup.lifestyle[genAbilities.Lifestyle + 2] }}</div>
      <div class="ability-value">
        <div [ngClass]="'circle' + ((genAbilities.Lifestyle <= -2) ? ' filled' : '')" (click)="genAbilities.Lifestyle = -2">−2</div>
        <div [ngClass]="'circle' + ((genAbilities.Lifestyle <= -1) ? ' filled' : '')" (click)="genAbilities.Lifestyle = -1">−1</div>
        <div class="circle filled" (click)="genAbilities.Lifestyle = 0">0</div>
        <div [ngClass]="'circle' + ((genAbilities.Lifestyle >= 1) ? ' filled' : '')" (click)="genAbilities.Lifestyle = 1">+1</div>
        <div [ngClass]="'circle' + ((genAbilities.Lifestyle >= 2) ? ' filled' : '')" (click)="genAbilities.Lifestyle = 2">+2</div>
      </div>
    </div>
  </div>
  <div class="stamina-section">
    <div class="panel grid">
      <div class="label">Health</div>
      <div class="ability-value">
        <div *ngFor="let i of aiToFrom(15)">
          <div class="circle" [ngClass]="'circle' + ((genAbilities.Health >= i) ? ' filled' : '')" (click)="setGenAbility('Health', i)">{{ i }}</div>
        </div>
      </div>
      <div class="label">Morale</div>
      <div class="ability-value">
        <div *ngFor="let i of aiToFrom(15)">
          <div class="circle" [ngClass]="'circle' + ((genAbilities.Morale >= i) ? ' filled' : '')" (click)="setGenAbility('Morale', i)">{{ i }}</div>
        </div>
      </div>
    </div>
    <div class="table">
      <div class="label">Threshold</div>
      <div class="label">Armor</div>
      <div class="value">{{ genAbilities.HealthThreshold }}</div>
      <div class="value">{{ calcArmor() }}</div>
      <div class="value">{{ genAbilities.MoraleThreshold }}</div>
      <div class="value">{{ calcGrit() }}</div>
      <div class="label">Threshold</div>
      <div class="label">Grit</div>
    </div>
  </div>
  <h4 class="title2"><span>Gear</span></h4>
  <h4 class="title3"><span>Sorcerous Spheres</span></h4>
  <div class="panel gear-panel">
    <div>
      @for (_ of gear; track _; let i = $index) {
        <div class="input">
          <input type="checkbox" class="gear" id="gear-iconic{{i}}" [(ngModel)]="gear[i].iconic" [ngModelOptions]="{standalone: true}">
          <input type="text" class="gear" id="gear{{i}}" [(ngModel)]="gear[i].value" [ngModelOptions]="{standalone: true}">
          <button class="del" (click)="delGear(i)">−</button>
        </div>
      }
      <div [ngClass]="'add' + ((gear.length >= 100) ? ' add-full' : '')"><button (click)="addGear()">+</button></div>
    </div>
  </div>
  <div class="panel spheres-panel">
    <div class="flex-column">
      @if (invAbilities.sorcerer.Corruption > 0) {
        <div class="label-tiny">Affects: <label><input type="radio" formControlName="sorceryAffects" value="health" /> Health</label>&nbsp;<label><input type="radio" formControlName="sorceryAffects" value="morale" /> Morale</label></div>
      }
      @for (i of aiToFrom(invAbilities.sorcerer.Corruption); track i;) {
        <input type="text" class="sphere" id="sphere{{i}}" [(ngModel)]="spheres[i]" [ngModelOptions]="{standalone: true}" [attr.list]="formGroup.controls.sorceryAffects.value + '-sphere-list'" />
      }
    </div>
  </div>
</div>
</div>
